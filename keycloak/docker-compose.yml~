---
services:
   keycloak:
     image: quay.io/keycloak/keycloak:24.0
     container_name: localhost
     hostname: localhost
     environment:
       KC_HOSTNAME: localhost
       KC_HOSTNAME_STRICT: false
       KC_HOSTNAME_STRICT_HTTPS: false
 
       KC_LOG_LEVEL: info
       KC_METRICS_ENABLED: true
       KC_HEALTH_ENABLED: true
       KEYCLOAK_ADMIN: admin
       KEYCLOAK_ADMIN_PASSWORD: admin
       
       KC_HTTPS_CERTIFICATE_FILE: /opt/keycloak/conf/server.crt
       KC_HTTPS_CERTIFICATE_KEY_FILE: /opt/keycloak/conf/server.key

       KC_DB: postgres
       KC_DB_URL: jdbc:postgresql://postgres:5432/keycloak
       KC_DB_USERNAME: postgres
       KC_DB_PASSWORD: postgres

     volumes:
       - ./conf/keycloak-1.crt:/opt/keycloak/conf/server.crt
       - ./conf/keycloak-1.key:/opt/keycloak/conf/server.key
     healthcheck:
       test: ["CMD", "curl", "-f", "http://localhost:7080/health/ready"]
       interval: 15s
       timeout: 2s
       retries: 15
     command: ["start-dev", "--http-port", "7080", "--https-port", "7443"]
     ports:
       - "7080:7080"
       - "7443:7443"
     networks:
       - backend

networks:
  backend:
    name: postgres
    driver: bridge
